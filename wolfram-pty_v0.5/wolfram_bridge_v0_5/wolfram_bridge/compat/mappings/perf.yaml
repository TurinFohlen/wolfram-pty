# perf.yaml — Python 性能工具 → Wolfram Language 映射规则（~30 条）
# 覆盖：numba、lru_cache、numpy.einsum、scipy.sparse、CuPy 等

# ═══════════════════════════════════════════════════════
#  1. 编译加速 Compilation / JIT
# ═══════════════════════════════════════════════════════

- python_path: numba.jit
  wolfram_function: Compile
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [jit, compile, numba, performance]
  description: "JIT compile function (WL: Compile) 函数JIT编译"

- python_path: numba.njit
  wolfram_function: "Compile[#, RuntimeOptions->{\"Speed\"}]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [njit, compile, numba, performance]
  description: "No-Python JIT compile 严格JIT编译"

- python_path: numba.vectorize
  wolfram_function: Vectorize
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [vectorize, ufunc, numba, performance]
  description: "Vectorized ufunc (WL: Vectorize) 向量化函数"

- python_path: jax.jit
  wolfram_function: "Compile[#, CompilationTarget->\"C\"]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [jit, jax, compile, performance]
  description: "JAX JIT compile (WL: C-target Compile) JAX JIT编译"

- python_path: jax.vmap
  wolfram_function: "Compile[{#}, Map[#, ##]]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [vmap, vectorize, jax, performance]
  description: "Vectorized map (WL: Map over compiled) 向量化映射"

- python_path: numpy.vectorize
  wolfram_function: "Map[#, ##, {-1}]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_numpy
  tags: [vectorize, map, numpy, performance]
  description: "Vectorize Python function over array 向量化Python函数"

# ═══════════════════════════════════════════════════════
#  2. 缓存 / 记忆化
# ═══════════════════════════════════════════════════════

- python_path: functools.lru_cache
  wolfram_function: "f[x_] := f[x] = #[x]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [lru_cache, memoize, cache, performance]
  description: "LRU cache (WL: UpValues memoization) LRU缓存"

- python_path: functools.cache
  wolfram_function: "f[x_] := f[x] = #[x]&"
  input_converter: to_wl_passthrough
  output_converter: from_wl_passthrough
  tags: [cache, memoize, performance]
  description: "Function cache (WL: memoization) 函数缓存"

# ═══════════════════════════════════════════════════════
#  3. 并行计算
# ═══════════════════════════════════════════════════════

- python_path: multiprocessing.Pool.map
  wolfram_function: ParallelMap
  input_converter: to_wl_passthrough
  output_converter: from_wl_json
  tags: [parallel, multiprocessing, performance]
  description: "Parallel map 并行Map"

- python_path: multiprocessing.Pool.starmap
  wolfram_function: ParallelMap
  input_converter: to_wl_passthrough
  output_converter: from_wl_json
  tags: [parallel, multiprocessing, performance]
  description: "Parallel starmap 并行多参数Map"

- python_path: joblib.Parallel
  wolfram_function: ParallelTable
  input_converter: to_wl_passthrough
  output_converter: from_wl_json
  tags: [parallel, joblib, performance]
  description: "Joblib parallel (WL: ParallelTable) Joblib并行"

- python_path: concurrent.futures.ThreadPoolExecutor.map
  wolfram_function: ParallelMap
  input_converter: to_wl_passthrough
  output_converter: from_wl_json
  tags: [parallel, thread, futures, performance]
  description: "Thread pool map 线程池Map"

# ═══════════════════════════════════════════════════════
#  4. 张量收缩 / 高效运算
# ═══════════════════════════════════════════════════════

- python_path: numpy.einsum
  wolfram_function: TensorContract
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [einsum, tensor, contract, performance]
  description: "Einstein summation (WL: TensorContract) 爱因斯坦求和"

- python_path: numpy.tensordot
  wolfram_function: TensorContract
  input_converters: [to_wl_list, to_wl_list]
  output_converter: from_wl_numpy
  tags: [tensordot, tensor, contract, performance]
  description: "Tensor dot product 张量点积"

# ═══════════════════════════════════════════════════════
#  5. 稀疏矩阵
# ═══════════════════════════════════════════════════════

- python_path: scipy.sparse.csr_matrix
  wolfram_function: SparseArray
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [sparse, csr, scipy, performance, memory]
  description: "CSR sparse matrix (WL: SparseArray) CSR稀疏矩阵"

- python_path: scipy.sparse.csc_matrix
  wolfram_function: SparseArray
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [sparse, csc, scipy, performance, memory]
  description: "CSC sparse matrix (WL: SparseArray) CSC稀疏矩阵"

- python_path: scipy.sparse.lil_matrix
  wolfram_function: SparseArray
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [sparse, lil, scipy, performance, memory]
  description: "LIL sparse matrix 链表稀疏矩阵"

# ═══════════════════════════════════════════════════════
#  6. 内存打包 / GPU
# ═══════════════════════════════════════════════════════

- python_path: numpy.asarray
  wolfram_function: "Developer`ToPackedArray"
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [asarray, packed, numpy, performance, memory]
  description: "Pack array for performance (WL: ToPackedArray) 打包数组加速"

- python_path: cupy.array
  wolfram_function: "Developer`ToPackedArray"
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [cupy, gpu, array, performance]
  description: "CuPy GPU array (WL: packed array) GPU数组"

- python_path: cupy.zeros
  wolfram_function: ConstantArray
  input_converters: [to_wl_scalar, to_wl_list]
  output_converter: from_wl_numpy
  tags: [cupy, gpu, zeros, performance]
  description: "CuPy zero GPU tensor 零GPU张量"

# ═══════════════════════════════════════════════════════
#  7. 插值 / 预计算
# ═══════════════════════════════════════════════════════

- python_path: scipy.interpolate.interp1d
  wolfram_function: Interpolation
  input_converter: to_wl_list
  output_converter: from_wl_passthrough
  tags: [interpolate, 1d, scipy, performance]
  description: "1D interpolation (WL: Interpolation) 一维插值"

- python_path: scipy.interpolate.RegularGridInterpolator
  wolfram_function: Interpolation
  input_converter: to_wl_list
  output_converter: from_wl_passthrough
  tags: [interpolate, grid, scipy, performance]
  description: "Grid interpolation (WL: Interpolation) 网格插值"

- python_path: scipy.interpolate.griddata
  wolfram_function: "Interpolation[#, Method->\"Spline\"]&"
  input_converter: to_wl_list
  output_converter: from_wl_passthrough
  tags: [interpolate, unstructured, scipy, performance]
  description: "Unstructured interpolation 非结构化插值"

# ═══════════════════════════════════════════════════════
#  8. FFT 性能（scipy vs numpy）
# ═══════════════════════════════════════════════════════

- python_path: scipy.fft.fft
  wolfram_function: Fourier
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [fft, scipy, performance, signal]
  description: "SciPy FFT (faster than NumPy) 高性能FFT"

- python_path: scipy.fft.ifft
  wolfram_function: InverseFourier
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [ifft, scipy, performance, signal]
  description: "SciPy inverse FFT 高性能逆FFT"

- python_path: scipy.fft.rfft
  wolfram_function: FourierDCT
  input_converter: to_wl_list
  output_converter: from_wl_numpy
  tags: [rfft, scipy, real fft, performance]
  description: "SciPy real FFT 高性能实FFT"

- python_path: scipy.fft.fft2
  wolfram_function: Fourier
  input_converter: to_wl_matrix
  output_converter: from_wl_numpy
  tags: [fft2, 2d, scipy, performance]
  description: "SciPy 2D FFT 二维高性能FFT"
